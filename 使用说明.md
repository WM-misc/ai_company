# 智能商城客服系统 - 使用说明

## 🚀 快速开始

### 1. 启动主服务器
```bash
npm start
```
服务器将在 http://localhost:3000 启动

### 2. 启动Webhook测试服务器（可选）
```bash
node test-webhook.js
```
测试服务器将在 http://localhost:3001 启动

## 📱 功能演示

### 商城首页
访问 http://localhost:3000
- 查看商品列表
- 点击"在线客服"或悬浮聊天按钮进入客服系统

### 用户端客服
访问 http://localhost:3000/customer
- 自动生成用户ID
- 发送文字消息
- 上传图片和文件
- 实时接收客服回复

### 客服端工作台
访问 http://localhost:3000/service
- 查看所有用户对话列表
- 点击对话进行回复
- 发送文字消息和文件
- 实时接收用户消息

## 🔧 测试步骤

### 1. 基础功能测试
1. 打开两个浏览器窗口
2. 窗口1访问用户端：http://localhost:3000/customer
3. 窗口2访问客服端：http://localhost:3000/service
4. 在用户端发送消息
5. 在客服端查看并回复

### 2. 文件上传测试
1. 在用户端点击📎按钮
2. 选择图片或文档文件
3. 文件自动上传并发送
4. 在客服端查看文件消息

### 3. Webhook功能测试
1. 启动webhook测试服务器：`node test-webhook.js`
2. 在用户端发送消息
3. 查看测试服务器控制台输出
4. 验证webhook数据格式

## 📊 功能特性验证

### ✅ 已实现功能
- [x] 商城首页展示
- [x] 用户端实时聊天
- [x] 客服端工作台
- [x] 文件上传功能
- [x] 图片显示功能
- [x] 实时消息推送
- [x] Webhook到AI服务
- [x] 响应式设计
- [x] 现代化UI界面

### 🔄 实时通信
- Socket.IO连接状态监控
- 消息实时推送
- 文件上传进度显示
- 连接断开重连

### 📁 文件处理
- 支持格式：图片、PDF、文档、文本
- 文件大小限制：10MB
- 自动生成唯一文件名
- 文件URL生成和访问

### 🤖 AI服务集成
- 用户消息触发webhook
- 后端webhook发送
- 可配置服务地址
- 认证token支持
- 错误处理和重试

## 🛠️ 技术实现

### 后端架构
```
Express服务器
├── Socket.IO (实时通信)
├── Multer (文件上传)
├── 内存数据存储
└── Webhook发送器
```

### 前端架构
```
静态页面
├── 商城首页 (index.html)
├── 用户端 (customer.html)
└── 客服端 (service.html)
```

### 数据流
```
用户消息 → Socket.IO → 服务器 → 保存到内存 → Webhook → AI服务
                                    ↓
客服回复 ← Socket.IO ← 服务器 ← 保存到内存
```

## 🔍 调试和监控

### 服务器日志
- 用户连接/断开
- 消息发送/接收
- 文件上传状态
- Webhook发送结果

### 浏览器控制台
- Socket.IO连接状态
- 消息发送状态
- 文件上传进度
- 错误信息

### Webhook测试
- 启动测试服务器
- 监控webhook接收
- 验证数据格式
- 检查响应状态

## 📝 API文档

### 商品API
```http
GET /api/products
GET /api/products/:id
```

### 文件上传API
```http
POST /api/upload
Content-Type: multipart/form-data
```

### 客服API
```http
GET /api/conversations/:userId
POST /api/service/reply
GET /api/service/conversations
```

### Webhook配置
```bash
# 环境变量
AI_WEBHOOK_URL=http://localhost:3001/ai-webhook
AI_WEBHOOK_TOKEN=your-token-here
```

## 🎯 使用场景

### 电商客服
- 商品咨询
- 订单查询
- 售后服务
- 技术支持

### 在线教育
- 课程咨询
- 作业提交
- 学习指导
- 问题解答

### 技术支持
- 问题报告
- 截图上传
- 远程协助
- 解决方案

## 🔒 安全考虑

### 文件上传安全
- 文件类型验证
- 文件大小限制
- 唯一文件名生成
- 路径遍历防护

### 通信安全
- HTTPS支持（生产环境）
- 输入验证
- XSS防护
- CSRF防护

### 数据安全
- 内存数据（开发环境）
- 数据库加密（生产环境）
- 敏感信息保护
- 访问权限控制

## 🚀 部署建议

### 开发环境
- Node.js本地运行
- 内存数据存储
- 文件本地存储

### 生产环境
- 使用PM2或Docker
- 数据库持久化
- 云存储服务
- HTTPS证书
- 负载均衡

## 📞 技术支持

如有问题或建议，请检查：
1. 服务器是否正常启动
2. 端口是否被占用
3. 浏览器控制台错误
4. 网络连接状态
5. 文件权限设置 